<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crossvalidation Demo • FNN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Crossvalidation Demo">
<meta property="og:description" content="FNN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FNN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/FNN.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Vignettes</li>
    <li>
      <a href="../articles/FNN_vignette_temp.html">Vignette #1</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/b-thi/FNN/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Crossvalidation Demo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-thi/FNN/blob/master/vignettes/cv_demo.rmd"><code>vignettes/cv_demo.rmd</code></a></small>
      <div class="hidden name"><code>cv_demo.rmd</code></div>

    </div>

    
    
<div id="crossvalidation-demo" class="section level1">
<h1 class="hasAnchor">
<a href="#crossvalidation-demo" class="anchor"></a>Crossvalidation Demo</h1>
<p>Crossvalidation (cv) is important to quantify the uncertainty in any models predictive power. The FNN package offers an easy and simple implementation of cv for users to apply in their own contexts.</p>
<p>First, we’ll read in the data and load some libraries.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Libraries</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fda</span>)</pre></body></html></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: 'fda'</code></pre>
<pre><code>## The following object is masked from 'package:graphics':
## 
##     matplot</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">FNN</span>)</pre></body></html></div>
<pre><code>## Warning: replacing previous import 'caret::train' by 'tensorflow::train' when
## loading 'FNN'</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Loading data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"daily"</span>)</pre></body></html></div>
<p>Before doing anything else, we’re going to do some pre-processing to get our functional observations. Remember, we can let the fnn.fit() function do this for us (as see in the classification example) but, for this example, let’s do it ourselves.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Creating functional data</span>
<span class="no">nbasis</span> <span class="kw">=</span> <span class="fl">65</span>
<span class="no">tempbasis65</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fda/man/create.fourier.basis.html">create.fourier.basis</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">365</span>), <span class="no">nbasis</span>)
<span class="no">timepts</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">365</span>, <span class="fl">1</span>)
<span class="no">temp_fd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fda/man/Data2fd.html">Data2fd</a></span>(<span class="no">timepts</span>, <span class="no">daily</span>$<span class="no">tempav</span>, <span class="no">tempbasis65</span>)</pre></body></html></div>
<p>In the chunk of code above, we are creating functional observations using a 65 term Fourier basis expansion. The Data2fd() function converts the raw data into the functional data objects that we need. In particular, we are concerned with the coefficients defining each of the 35 functional observations here (one set for each of the 35 cities). Let’s not extract out those functional observations and get them into the format required for the fnn.fit() function:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Non functional covariate</span>
<span class="no">weather_scalar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">total_prec</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">daily</span>$<span class="no">precav</span>, <span class="fl">2</span>, <span class="no">sum</span>))

<span class="co"># Setting up data to pass in to function</span>
<span class="no">weather_data_full</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nbasis</span>, <span class="fl">35</span>, <span class="fl">1</span>))
<span class="no">weather_data_full</span>[,,<span class="fl">1</span>] <span class="kw">=</span> <span class="no">temp_fd</span>$<span class="no">coefs</span>
<span class="no">scalar_full</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">weather_scalar</span>[,<span class="fl">1</span>])
<span class="no">total_prec</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">daily</span>$<span class="no">precav</span>, <span class="fl">2</span>, <span class="no">mean</span>)</pre></body></html></div>
<p>Above, we first define a scalar covariate in the appropriate matrix format. The scalar covariate is the total amount of rain over the year in each of the cities (feel free to leave this covariate out). We then store the functional curves (and in particular, the coefficients) from the functional object, into a tensor. Here, the tensor is actually just a matrix because we have only 1 functional covariate (temperature curves for the year). Finally, let’s run our cross-valiation function!</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># cross-validating</span>
<span class="no">cv_example</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fnn.cv.html">fnn.cv</a></span>(<span class="kw">nfolds</span> <span class="kw">=</span> <span class="fl">5</span>,
                     <span class="kw">resp</span> <span class="kw">=</span> <span class="no">total_prec</span>,
                     <span class="kw">func_cov</span> <span class="kw">=</span> <span class="no">weather_data_full</span>,
                     <span class="kw">scalar_cov</span> <span class="kw">=</span> <span class="no">scalar_full</span>,
                     <span class="kw">domain_range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">365</span>)),
                     <span class="kw">learn_rate</span> <span class="kw">=</span> <span class="fl">0.001</span>)</pre></body></html></div>
<pre><code>## Model
## ________________________________________________________________________________
## Layer (type)                        Output Shape                    Param #     
## ================================================================================
## dense (Dense)                       (None, 64)                      576         
## ________________________________________________________________________________
## dense_1 (Dense)                     (None, 64)                      4160        
## ________________________________________________________________________________
## dense_2 (Dense)                     (None, 1)                       65          
## ================================================================================
## Total params: 4,801
## Trainable params: 4,801
## Non-trainable params: 0
## ________________________________________________________________________________
## 
## 
## 
## xxxxxxxxxxxxxxxxxx</code></pre>
<p><img src="cv_demo_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<pre><code>## 
## Trained on 23 samples (batch_size=32, epochs=18)
## Final epoch (plot to see history):
##                   loss: 0.8828
##     mean_squared_error: 0.8828
##               val_loss: 6.547
## val_mean_squared_error: 6.547 
## 
## [1] "Folds Done: 1"
## Model
## ________________________________________________________________________________
## Layer (type)                        Output Shape                    Param #     
## ================================================================================
## dense_3 (Dense)                     (None, 64)                      576         
## ________________________________________________________________________________
## dense_4 (Dense)                     (None, 64)                      4160        
## ________________________________________________________________________________
## dense_5 (Dense)                     (None, 1)                       65          
## ================================================================================
## Total params: 4,801
## Trainable params: 4,801
## Non-trainable params: 0
## ________________________________________________________________________________
## 
## 
## 
## xxxxxxxxxxxxxxxxx</code></pre>
<p><img src="cv_demo_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<pre><code>## 
## Trained on 22 samples (batch_size=32, epochs=17)
## Final epoch (plot to see history):
##                   loss: 1.175
##     mean_squared_error: 1.175
##               val_loss: 2.242
## val_mean_squared_error: 2.242 
## 
## [1] "Folds Done: 2"
## Model
## ________________________________________________________________________________
## Layer (type)                        Output Shape                    Param #     
## ================================================================================
## dense_6 (Dense)                     (None, 64)                      576         
## ________________________________________________________________________________
## dense_7 (Dense)                     (None, 64)                      4160        
## ________________________________________________________________________________
## dense_8 (Dense)                     (None, 1)                       65          
## ================================================================================
## Total params: 4,801
## Trainable params: 4,801
## Non-trainable params: 0
## ________________________________________________________________________________
## 
## 
## 
## xxxxxxxxxxxxxxxxxxxxxxxx</code></pre>
<p><img src="cv_demo_files/figure-html/unnamed-chunk-4-3.png" width="700"></p>
<pre><code>## 
## Trained on 21 samples (batch_size=32, epochs=24)
## Final epoch (plot to see history):
##                   loss: 1.693
##     mean_squared_error: 1.693
##               val_loss: 6.536
## val_mean_squared_error: 6.536 
## 
## [1] "Folds Done: 3"
## Model
## ________________________________________________________________________________
## Layer (type)                        Output Shape                    Param #     
## ================================================================================
## dense_9 (Dense)                     (None, 64)                      576         
## ________________________________________________________________________________
## dense_10 (Dense)                    (None, 64)                      4160        
## ________________________________________________________________________________
## dense_11 (Dense)                    (None, 1)                       65          
## ================================================================================
## Total params: 4,801
## Trainable params: 4,801
## Non-trainable params: 0
## ________________________________________________________________________________
## 
## 
## 
## xxxxxxxxxxxxxxxxxxxxxx</code></pre>
<p><img src="cv_demo_files/figure-html/unnamed-chunk-4-4.png" width="700"></p>
<pre><code>## 
## Trained on 22 samples (batch_size=32, epochs=22)
## Final epoch (plot to see history):
##                   loss: 1.043
##     mean_squared_error: 1.043
##               val_loss: 6.26
## val_mean_squared_error: 6.26 
## 
## [1] "Folds Done: 4"
## Model
## ________________________________________________________________________________
## Layer (type)                        Output Shape                    Param #     
## ================================================================================
## dense_12 (Dense)                    (None, 64)                      576         
## ________________________________________________________________________________
## dense_13 (Dense)                    (None, 64)                      4160        
## ________________________________________________________________________________
## dense_14 (Dense)                    (None, 1)                       65          
## ================================================================================
## Total params: 4,801
## Trainable params: 4,801
## Non-trainable params: 0
## ________________________________________________________________________________
## 
## 
## 
## xxxxxxxxxxxxxxxxxx</code></pre>
<p><img src="cv_demo_files/figure-html/unnamed-chunk-4-5.png" width="700"></p>
<pre><code>## 
## Trained on 22 samples (batch_size=32, epochs=18)
## Final epoch (plot to see history):
##                   loss: 2.492
##     mean_squared_error: 2.492
##               val_loss: 5.843
## val_mean_squared_error: 5.843 
## 
## [1] "Folds Done: 5"</code></pre>
<p>We can adjust the number of folds with nfolds option. We leave the model at its defaults but you can definitely improve the model fitting across the folds with a more appropriate number of layers, neurons, etc.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Barinder Thind, <a href="http://people.stat.sfu.ca/~cao/">Jiguo Cao</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
