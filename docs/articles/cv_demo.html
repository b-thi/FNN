<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crossvalidation Demo â€¢ FNN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Crossvalidation Demo">
<meta property="og:description" content="FNN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FNN </a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version"> 1.0 </span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<!-- <li>
  <a href="../index.html">Main</a>
</li> -->
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Demos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Examples</li>
    <li>
      <a href="reg_demo.html">Regression Demo</a>
    </li>
        <li>
      <a href="class_demo.html">Classification Demo</a>
    </li>
        <li>
      <a href="cv_demo.html">Cross-validation Demo</a>
    </li>
        <li>
      <a href="tune_demo.html">Tuning Demo</a>
    </li>
    <li class="divider">
    <li>
      <a href="index.html">Upcoming</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/b-thi/FNN/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Crossvalidation Demo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-thi/FNN/blob/master/vignettes/cv_demo.rmd"><code>vignettes/cv_demo.rmd</code></a></small>
      <div class="hidden name"><code>cv_demo.rmd</code></div>

    </div>

    

<p>Crossvalidation (cv) is important to quantify the uncertainty in any models predictive power. The FNN package offers an easy and simple implementation of cv for users to apply in their own contexts. </p>
<p>First, we&#39;ll read in the data and load some libraries.</p>
<pre><code class="lang-r"><span class="hljs-meta"># Libraries</span>
library(fda)

<span class="hljs-meta"># Loading data</span>
data(<span class="hljs-string">"daily"</span>)
</code></pre>
<p>Before doing anything else, we&#39;re going to do some pre-processing to get our functional observations. Remember, we can let the fnn.fit() function do this for us (as see in the classification example) but, for this example, let&#39;s do it ourselves.</p>
<pre><code class="lang-r"><span class="hljs-comment"># Creating functional data</span>
<span class="hljs-attr">nbasis</span> = <span class="hljs-number">65</span>
<span class="hljs-attr">tempbasis65</span>  = create.fourier.basis(c(<span class="hljs-number">0</span>,<span class="hljs-number">365</span>), nbasis)
<span class="hljs-attr">timepts</span> = seq(<span class="hljs-number">1</span>, <span class="hljs-number">365</span>, <span class="hljs-number">1</span>)
<span class="hljs-attr">temp_fd</span> = Data2fd(timepts, daily<span class="hljs-variable">$tempav</span>, tempbasis65)
</code></pre>
<p>In the chunk of code above, we are creating functional observations using a 65 term Fourier basis expansion. The Data2fd() function converts the raw data into the functional data objects that we need. In particular, we are concerned with the coefficients defining each of the 35 functional observations here (one set for each of the 35 cities). Let&#39;s not extract out those functional observations and get them into the format required for the fnn.fit() function:</p>
<pre><code class="lang-r"># Non functional covariate
weather_scalar = <span class="hljs-keyword">data</span>.frame(total_prec = apply(daily$precav, <span class="hljs-number">2</span>, <span class="hljs-built_in">sum</span>))

# Setting up <span class="hljs-keyword">data</span> to <span class="hljs-keyword">pass</span> <span class="hljs-keyword">in</span> to <span class="hljs-function"><span class="hljs-keyword">function</span></span>
weather_data_full &lt;- array(<span class="hljs-built_in">dim</span> = c(nbasis, <span class="hljs-number">35</span>, <span class="hljs-number">1</span>))
weather_data_full[,,<span class="hljs-number">1</span>] = temp_fd$coefs
scalar_full = <span class="hljs-keyword">data</span>.frame(weather_scalar[,<span class="hljs-number">1</span>])
total_prec = apply(daily$precav, <span class="hljs-number">2</span>, mean)
</code></pre>
<p>Above, we first define a scalar covariate in the appropriate matrix format. The scalar covariate is the total amount of rain over the year in each of the cities (feel free to leave this covariate out). We then store the functional curves (and in particular, the coefficients) from the functional object, into a tensor. Here, the tensor is actually just a matrix because we have only 1 functional covariate (temperature curves for the year). Finally, let&#39;s run our cross-valiation function!</p>
<pre><code class="lang-r"><span class="hljs-comment"># cross-validating</span>
cv_example &lt;- fnn.cv(<span class="hljs-attr">nfolds</span> = <span class="hljs-number">5</span>,
                     <span class="hljs-attr">resp</span> = total_prec,
                     <span class="hljs-attr">func_cov</span> = weather_data_full,
                     <span class="hljs-attr">scalar_cov</span> = scalar_full,
                     <span class="hljs-attr">domain_range</span> = list(c(<span class="hljs-number">1</span>, <span class="hljs-number">365</span>)),
                     <span class="hljs-attr">learn_rate</span> = <span class="hljs-number">0.001</span>)
</code></pre>
<p>We can adjust the number of folds with nfolds option. We leave the model at its defaults but you can definitely improve the model fitting across the folds with a more appropriate number of layers, neurons, etc.</p>



      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://b-thi.github.io/'>Barinder Thind</a> <br> Funded by <a href='http://people.stat.sfu.ca/~cao/'>Jiguo Cao</a></p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
