<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regression Demo • FNN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Regression Demo">
<meta property="og:description" content="FNN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FNN </a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version"> 1.0 </span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<!-- <li>
  <a href="../index.html">Main</a>
</li> -->
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Demos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Examples</li>
    <li>
      <a href="reg_demo.html">Regression Demo</a>
    </li>
        <li>
      <a href="class_demo.html">Classification Demo</a>
    </li>
        <li>
      <a href="cv_demo.html">Cross-validation Demo</a>
    </li>
        <li>
      <a href="tune_demo.html">Tuning Demo</a>
    </li>
    <li class="divider">
    <li>
      <a href="index.html">Upcoming</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/b-thi/FNN/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Regression Demo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-thi/FNN/blob/master/vignettes/reg_demo.rmd"><code>vignettes/reg_demo.rmd</code></a></small>
      <div class="hidden name"><code>reg_demo.rmd</code></div>

    </div>

    
    
<div id="regression-demo" class="section level1">
<p>Here, we present an example of a regression problem. We are concerned with the fat contents of meat samples as a scalar response. We will use the absorbance curves and their derivatives (functional covariates) along with the water contents (scalar covariate) as our predictors.</p>
<p>First, we’ll read in the data and load some libraries.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># loading data</span>
<span class="no">tecator</span> <span class="kw">=</span> <span class="kw pkg">FNN</span><span class="kw ns">::</span><span class="no"><a href="../reference/tecator.html">tecator</a></span></pre></body></html></div>
<pre><code>## Warning: replacing previous import 'caret::train' by 'tensorflow::train' when
## loading 'FNN'</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># libraries</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fda</span>)</pre></body></html></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: 'fda'</code></pre>
<pre><code>## The following object is masked from 'package:graphics':
## 
##     matplot</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">FNN</span>)</pre></body></html></div>
<p>Before doing anything else, we’re going to do some pre-processing to get our functional observations. Remember, we can let the fnn.fit() function do this for us (as see in the classification example) but, for this example, let’s do it ourselves.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># define the time points on which the functional predictor is observed.</span>
<span class="no">timepts</span> <span class="kw">=</span> <span class="no">tecator</span>$<span class="no">absorp.fdata</span>$<span class="no">argvals</span>

<span class="co"># define the fourier basis</span>
<span class="no">nbasis</span> <span class="kw">=</span> <span class="fl">29</span>
<span class="no">spline_basis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fda/man/create.fourier.basis.html">create.fourier.basis</a></span>(<span class="no">tecator</span>$<span class="no">absorp.fdata</span>$<span class="no">rangeval</span>, <span class="no">nbasis</span>)

<span class="co"># convert the functional predictor into a fda object and getting deriv</span>
<span class="no">tecator_fd</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/fda/man/Data2fd.html">Data2fd</a></span>(<span class="no">timepts</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">tecator</span>$<span class="no">absorp.fdata</span>$<span class="no">data</span>), <span class="no">spline_basis</span>)
<span class="no">tecator_deriv</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fda/man/deriv.fd.html">deriv.fd</a></span>(<span class="no">tecator_fd</span>)
<span class="no">tecator_deriv2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fda/man/deriv.fd.html">deriv.fd</a></span>(<span class="no">tecator_deriv</span>)</pre></body></html></div>
<p>In the chunk of code above, we are creating functional observations using a 29 term Fourier basis expansion. These functions are available in the fda package. The Data2fd() function converts the raw data into the functional data objects that we need. We are going to use multiple functional covariates as alluded to earlier by using the derivatives of the absorbance curves; we can easily acquire these derivatives by using the deriv.fd function.</p>
<p>Let’s now get our scalar covariate</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Non functional covariate</span>
<span class="no">tecator_scalar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">water</span> <span class="kw">=</span> <span class="no">tecator</span>$<span class="no">y</span>$<span class="no">Water</span>)</pre></body></html></div>
<p>And our response</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Response</span>
<span class="no">tecator_resp</span> <span class="kw">=</span> <span class="no">tecator</span>$<span class="no">y</span>$<span class="no">Fat</span></pre></body></html></div>
<p>We now need to create a tensor containing the functional covariates (as defined by their coefficients) so that it can be passed into the main model function:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Getting data into right format</span>
<span class="no">tecator_data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nbasis</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">tecator_resp</span>), <span class="fl">3</span>))
<span class="no">tecator_data</span>[,,<span class="fl">1</span>] <span class="kw">=</span> <span class="no">tecator_fd</span>$<span class="no">coefs</span>
<span class="no">tecator_data</span>[,,<span class="fl">2</span>] <span class="kw">=</span> <span class="no">tecator_deriv</span>$<span class="no">coefs</span>
<span class="no">tecator_data</span>[,,<span class="fl">3</span>] <span class="kw">=</span> <span class="no">tecator_deriv2</span>$<span class="no">coefs</span></pre></body></html></div>
<p>And the last step before building our model, we create a test train split. This will be quite a few lines of code but all of them are just splitting each of the functional and scalar covariates, as well as the response. In this case, we will use the first 165 curves as the training set and use the final 50 as the test set.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Splitting into test and train for third FNN</span>
<span class="no">ind</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">165</span>
<span class="no">tec_data_train</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nbasis</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ind</span>), <span class="fl">3</span>))
<span class="no">tec_data_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nbasis</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">tecator</span>$<span class="no">absorp.fdata</span>$<span class="no">data</span>) - <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ind</span>), <span class="fl">3</span>))
<span class="no">tec_data_train</span> <span class="kw">=</span> <span class="no">tecator_data</span>[, <span class="no">ind</span>, ]
<span class="no">tec_data_test</span> <span class="kw">=</span> <span class="no">tecator_data</span>[, -<span class="no">ind</span>, ]
<span class="no">tecResp_train</span> <span class="kw">=</span> <span class="no">tecator_resp</span>[<span class="no">ind</span>]
<span class="no">tecResp_test</span> <span class="kw">=</span> <span class="no">tecator_resp</span>[-<span class="no">ind</span>]
<span class="no">scalar_train</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">tecator_scalar</span>[<span class="no">ind</span>,<span class="fl">1</span>])
<span class="no">scalar_test</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">tecator_scalar</span>[-<span class="no">ind</span>,<span class="fl">1</span>])</pre></body></html></div>
<p>We now build the model:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># Setting up network</span>
<span class="no">tecator_fnn</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fnn.fit.html">fnn.fit</a></span>(<span class="kw">resp</span> <span class="kw">=</span> <span class="no">tecResp_train</span>,
                      <span class="kw">func_cov</span> <span class="kw">=</span> <span class="no">tec_data_train</span>,
                      <span class="kw">scalar_cov</span> <span class="kw">=</span> <span class="no">scalar_train</span>,
                      <span class="kw">basis_choice</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fourier"</span>, <span class="st">"fourier"</span>, <span class="st">"fourier"</span>),
                      <span class="kw">num_basis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">7</span>),
                      <span class="kw">hidden_layers</span> <span class="kw">=</span> <span class="fl">4</span>,
                      <span class="kw">neurons_per_layer</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">64</span>, <span class="fl">64</span>, <span class="fl">64</span>, <span class="fl">64</span>),
                      <span class="kw">activations_in_layers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"relu"</span>, <span class="st">"relu"</span>, <span class="st">"relu"</span>, <span class="st">"linear"</span>),
                      <span class="kw">domain_range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">850</span>, <span class="fl">1050</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">850</span>, <span class="fl">1050</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">850</span>, <span class="fl">1050</span>)),
                      <span class="kw">epochs</span> <span class="kw">=</span> <span class="fl">300</span>,
                      <span class="kw">learn_rate</span> <span class="kw">=</span> <span class="fl">0.002</span>)</pre></body></html></div>
<pre><code>## Model
## ________________________________________________________________________________
## Layer (type)                        Output Shape                    Param #     
## ================================================================================
## dense (Dense)                       (None, 64)                      1216        
## ________________________________________________________________________________
## dense_1 (Dense)                     (None, 64)                      4160        
## ________________________________________________________________________________
## dense_2 (Dense)                     (None, 64)                      4160        
## ________________________________________________________________________________
## dense_3 (Dense)                     (None, 64)                      4160        
## ________________________________________________________________________________
## dense_4 (Dense)                     (None, 1)                       65          
## ================================================================================
## Total params: 13,761
## Trainable params: 13,761
## Non-trainable params: 0
## ________________________________________________________________________________
## 
## 
## 
## xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></pre>
<p><img src="reg_demo_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<pre><code>## 
## Trained on 132 samples (batch_size=32, epochs=52)
## Final epoch (plot to see history):
##                   loss: 2.869
##     mean_squared_error: 2.869
##               val_loss: 5.15
## val_mean_squared_error: 5.15</code></pre>
<p>In this example, we build a 4 layer network each of which contains 64 neurons. We use 300 training iterations and define the 3 functional weights (for the 3 functional covariates) using 5, 5, and 7 basis functions, respectively.</p>
<p>Let’s now get some predictions!</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># Predicting</span>
<span class="no">pred_tec</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fnn.predict.html">fnn.predict</a></span>(<span class="no">tecator_fnn</span>,
                       <span class="no">tec_data_test</span>,
                       <span class="kw">scalar_cov</span> <span class="kw">=</span> <span class="no">scalar_test</span>,
                       <span class="kw">basis_choice</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fourier"</span>, <span class="st">"fourier"</span>, <span class="st">"fourier"</span>),
                       <span class="kw">num_basis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">7</span>),
                       <span class="kw">domain_range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">850</span>, <span class="fl">1050</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">850</span>, <span class="fl">1050</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">850</span>, <span class="fl">1050</span>)))</pre></body></html></div>
<p>Using this output, we can compare the predictions to the actual results in whatever way we would like!</p>
<p>And that is pretty much it for this example.</p>
</div>
  </div>

 
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://b-thi.github.io/'>Barinder Thind</a> <br> Funded by <a href='http://people.stat.sfu.ca/~cao/'>Jiguo Cao</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>
  


  </body>
</html>
